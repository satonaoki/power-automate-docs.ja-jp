---
title: カスタム アクションの作成 | MicrosoftDocs
description: システムで一連のコマンドを自動化する際にはカスタム アクションを使用します。 アクションによって、開発者が業務プロセスを表現するために使用できるボキャブラリが広がります。
ms.custom: ''
ms.date: 08/06/2018
ms.reviewer: matp
ms.service: flow
ms.topic: article
author: msftman
ms.assetid: 6dbc0f10-7ac5-4685-ab74-22d24bf7102d
ms.author: deonhe
manager: kvivek
search.app:
- Flow
search.audienceType:
- flowmaker
- enduser
ms.openlocfilehash: 140afe0c93b85363b8dab9658838d985ab9e786c
ms.sourcegitcommit: 835b005284b9ae21ae1742a7d36b574ba3884bef
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/29/2020
ms.locfileid: "74361477"
---
# <a name="create-a-custom-action"></a>カスタム アクションの作成
[!INCLUDE [view-pending-approvals](includes/cc-rebrand.md)]

システムで一連のコマンドを自動化する際にはカスタム アクションを使用します。 アクションによって、開発者がビジネス プロセスを表現するために使用できるボキャブラリが拡張されます。 "作成する"、"更新する"、"削除する"、"割り当てる" などの主要な動詞はシステムによって提供されており、アクションではこれらの中核となる動詞を使用して、"承認する"、"エスカレートする"、"ルーティングする"、"スケジュールする" などのさらに説明的な動詞を作成します。 ビジネス プロセスの定義が変わった場合に、開発者以外でもカスタム アクションを編集することができ、コードを変更する必要はありません。  
  
<a name="create"></a>   
## <a name="create-an-action"></a>アクションを作成する  
  
> [!IMPORTANT]
>  ソリューションの一部として配布するアクションを作成する場合には、そのソリューションのコンテキストでアクションを作成します。 **[[設定]](/powerapps/maker/model-driven-apps/advanced-navigation#settings)**  >  **[ソリューション]** に移動し、そのアクションを含めるアンマネージド ソリューションを探します。 次に、メニュー バーで **[新規]**  >  **[プロセス]** を選択します。 これにより、アクションの名前に関連付けられるカスタマイズ プレフィックスが、ソリューション内の他のコンポーネントと統一されるようになります。 アクションを作成した後でプレフィックスを変更することはできません。  
  
 ワークフロー プロセスと同様に、アクションの **[プロセスの作成]** ダイアログ ボックスには次のプロパティがあります。  
  
 **[プロセス名]**  
 プロセスの名前を入力すると、その名前からスペースや特殊文字が削除され、一意の名前が生成されます。  
  
 **[カテゴリ]**  
 このプロパティでは、これがアクション プロセスであると設定されます。 プロセスを保存した後でこれを変更することはできません。  
  
 **[エンティティ]**  
 アクションのプロセスでは、他の種類のプロセスと同じくワークフローのコンテキストを提供するエンティティを選択できます。ただし、 **[なし (グローバル)]** を選択するオプションもあります。 アクションで特定のエンティティのコンテキストが必要ない場合は、これを使用します。 プロセスを保存した後でこれを変更することはできません。  
  
 **[種類]**  
 このプロパティを使用して、新しいアクションを最初から作成するか、既存の点プレーに基づいて開始するかを選択します。  
 
ワークフロー プロセスとは異なり、次のオプションを設定する必要はありません。  
  
- **[Start When]\(開始のタイミング\)** : アクションは、アクションに対して生成されたメッセージをコードが呼び出すと開始します。  
  
- **[スコープ]** : アクションは常に呼び出し側ユーザーのコンテキストで実行されます。  
  
- **[バックグラウンドで実行]** : アクションは常にリアルタイム ワークフローです。  
  
また、アクションにはワークフロー プロセスにないものがあります。それは入力と出力の引数です。

> [!NOTE]
> コードを作成せずにワークフローからカスタム アクションを有効にすることができます。 詳細情報: [ワークフローからカスタム アクションを呼び出す](invoke-custom-actions-workflow-dialog.md)
 
<a name="edit"></a>   
## <a name="edit-an-action"></a>アクションを編集する  
 プロセスを編集するには、まず非アクティブ化する必要があります。  
  
 編集できるアクションは、アンマネージド ソリューションの一部として作成されたものか、組織にインストールされているソリューションに含まれているものです。 ソリューションがマネージド ソリューションである場合、編集することはできません。 ソリューション発行者には、マネージド プロパティを編集するオプションがあるため、マネージド ソリューションにインストールされているアクションは編集できません。  
  
 アクションを保存するとき、プロセス名に基づいて一意の名前が生成されます。 この一意の名前には、ソリューション発行者によってカスタマイズ プレフィックスが付けられています。 これは開発者がコード内で使用するメッセージの名前です。  
  
 アクションを編集するときには次のオプションがあります。  
  
 **[プロセス名]**  
 プロセスが作成され、プロセス名から一意の名前が生成された後で、プロセス名を編集できます。 名前付け規則を適用して、特定のプロセスを見つけやすい名前にすることをお勧めします。  
  
 **[一意の名前]**  
 アクションを保存するとき、プロセス名に基づいて一意の名前が生成されます。 この一意の名前には、ソリューション発行者によってカスタマイズ プレフィックスが付けられています。 これは開発者がコード内で使用するメッセージの名前です。 プロセスがアクティブ化され、この名前を使用してアクションを呼び出す予定のコードが配置されている場合には、この一意の名前を変更しないでください。  
  
> [!IMPORTANT]
>  アクションがアクティブ化され、一意の名前を使用するコードが記述された後では、一意の名前を変更するには参照元のコードも変更する必要があります。  
  
 **[ロールバックを有効にする]**  
 一般に、トランザクションをサポートするプロセスは、操作の一部が失敗すると操作全体を "元に戻します" (ロールバック)。 これには、いくつか例外があります。 開発者がアクションによって開始されたコードで実行する一部のアクションは、トランザクションをサポートしないことがあります。 たとえば、コードによって他のシステム内でアクションが実行され、トランザクションの範囲外である場合です。 これらは、アプリで実行されているアクションによってロールバックできません。 プラットフォームの一部のメッセージではトランザクションがサポートされません。 ただし、アクションのユーザー インターフェイスのみで行えるすべての操作ではトランザクションがサポートされます。 リアルタイム ワークフローに含まれるすべてのアクションは、トランザクション内にあると見なされます。ただし、これから除外できるアクションもあります。  
  
 このメッセージを使用する開発者と相談して、トランザクションに含める必要があるかどうかを決定してください。 一般的に、アクションをトランザクションに含める必要があるのは、ビジネス プロセスによって実行されるすべてのアクションが正常に終了しないと、つじつまが合わない場合です。 典型的な例としては、2 つの銀行口座間の送金があります。 一方の口座から現金を引き出したら、もう一方の口座に振り込む必要があります。 いずれかが失敗した場合は、両方とも失敗する必要があります。  
  
> [!NOTE]
>  ロールバックを有効にできないのは、カスタム アクションがワークフローないから直接呼び出される場合です。 アクションが Power Apps Web サービス メッセージによってトリガーされる場合は、ロールバックを有効にできます。  
  
 **[次の種類としてアクティブ化]**  
 すべてのプロセスと同じく、プロセスをテンプレートとしてアクティブ化することができます。これを使用すると、同じパターンのプロセスを作成するときに前進したところから開始できます。  
  
 **[Define Process Arguments]\(プロセスの引数の定義\)**  
 ここでは、アクションが開始時に予期するデータと、アクションから渡されるデータを指定します。 詳細情報: [プロセスの引数を定義する](#define-process-arguments)  
  
 **[Add Stages and steps]\(ステージとステップの追加\)**  
 他のプロセスと同様に、実行するアクションと、それをいつ実行するかを指定します。 詳細情報: [ステージとステップを追加する](#add-stages-and-steps)

<a name="BKMK_DefineProcessArgs"></a>   
## <a name="define-process-arguments"></a>プロセスの引数を定義する  
 開発者がメッセージを使用するとき、メッセージに渡すデータから始める場合があります。 たとえば、新しいケース レコードを作成するときは、入力引数として渡す新しいケース タイトル値が存在する場合があります。  
  
 メッセージが完成したら、開発者は、メッセージによって変更または生成されたデータを、コード内の別の操作に渡す必要があります。 このデータは出力引数です。  
  
 入力引数と出力引数は両方とも、名前、型、および引数が常に必須かどうかといった情報が必要です。 説明を指定することもできます。  
  
 メッセージの名前と、プロセスのすべての引数の情報が、メッセージの "シグネチャ" を表します。 アクションがアクティブ化されて、コード内で使用されるようになったら、シグネチャを変更することはできません。 このシグネチャが変更されると、メッセージを使用するコードはすべて失敗します。 この唯一の例外は、必ずしも必要ではないパラメーターのいずれかを変更した場合です。  
  
 引数は、並べ替えや位置を上下させるなど、順序を変更できます。引数は順序ではなく名前によって識別されるためです。 また、説明を変更しても、メッセージを使用するコードが失敗することはありません。  
  
### <a name="action-process-argument-types"></a>アクション プロセスの引数の型  
 次の表では、アクション プロセスの引数の型について説明します。  
  
|種類|説明|  
|----------|-----------------|  
|ブール値|`true` または `false` の値。|  
|DateTime|日付と時刻の情報を格納する値。|  
|Decimal|精度が小数点以下の数値。 精度がきわめて重要な場合に使用されます。|  
|Entity|指定したエンティティのレコードです。 Entity を選択すると、ドロップダウン リストが有効になり、エンティティの種類を選択できるようになります。|  
|EntityCollection|エンティティ レコードのコレクション。|  
|EntityReference|エンティティ レコードを一意に識別する、名前、ID、およびエンティティ レコードの種類を含むオブジェクト。 EntityReference を選択すると、ドロップダウン リストが有効になり、エンティティの種類を選択できるようになります。|  
|Float|精度が小数点以下の数値。 絶対的に正確ではない測定値のデータに対して使用されます。|  
|Integer|整数。|  
|Money|金額に関するデータを格納する値。|  
|Picklist|OptionSet 属性のオプションを表す値。|  
|String|テキスト値。|  
  
> [!NOTE]
> **EntityCollection** 引数値は、条件またはアクションについて、ユーザー インターフェイスで設定できません。 これらは、開発者がカスタム コードで使用するために提供されます。 詳細情報: [独自のアクションの作成](https://docs.microsoft.com/dynamics365/customer-engagement/developer/create-own-actions) 
  
<a name="BKMK_AddStagesConditionsAndActions"></a>   
### <a name="add-stages-and-steps"></a>ステージとステップを追加する  
 アクションは、リアルタイム ワークフローにとても良く似たプロセスの種類です。 リアルタイム ワークフローで使用できるすべてのステップは、アクションで使用できます。 リアルタイム ワークフローとアクションの両方で使用できるステップについては、[ワークフローのステージとステップ](configure-workflow-steps.md)に関するページをご覧ください。  
  
 リアルタイム ワークフローで使用できるステップの他に、アクションには **[値の割り当て]** ステップがあります。  アクションでは、これらは出力引数の設定にのみ使用できます。 フォーム アシスタントを使用して、出力引数に特定の値を設定することができます。または、アクションを実行した対象のレコード、そのレコードに多対一リレーションシップで関連するレコード、前のステップで作成されたレコードの値や、プロセスそのものに含まれる値を設定する方がよく行われます。  
  
## <a name="next-steps"></a>次の手順  
 [ワークフローからカスタム アクションを呼び出す](invoke-custom-actions-workflow-dialog.md)   

 
 
