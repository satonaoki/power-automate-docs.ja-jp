---
title: Power Apps で分岐を使用して業務プロセス フローを強化する | MicrosoftDocs
description: 業務プロセス フローで分岐を使用する方法について説明します。
ms.custom: ''
ms.date: 06/27/2018
ms.tgt_pltfrm: ''
ms.topic: article
ms.service: flow
author: MSFTMAN
ms.assetid: 62cfac6b-0d78-48de-9364-0287454aa2a0
caps.latest.revision: 9
ms.author: Deonhe
manager: kvivek
search.app:
- Flow
search.audienceType:
- flowmaker
- enduser
ms.openlocfilehash: 577bad2fa7e0db66c95fae5668c4a576e3c3a2d7
ms.sourcegitcommit: 52e739e5d53464b80e572928f131890562fc0396
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/21/2019
ms.locfileid: "74365180"
---
# <a name="tutorial-enhance-business-process-flows-with-branching"></a>チュートリアル: 分岐を使用して業務プロセス フローを強化する
[!INCLUDE [view-pending-approvals](includes/cc-rebrand.md)]

業務プロセス フローによって、販売、マーケティング、サービスのプロセスの完了までさまざまなステージが示されます。 単純なケースでは直線的な業務プロセス フローが適しています。 ただし、シナリオが複雑になると、分岐を使用して業務プロセス フローを強化することができます。 業務プロセス フローに対する作成権限を持っている場合、`If-Else` ロジックを使用して、複数の分岐を含む業務プロセス フローを作成できます。 分岐条件は、`AND` 演算子または `OR` 演算子を組み合わせて使用する複数の論理式で形成されます。 分岐の選択は、プロセス定義時に定義したルールに基づいて、リアルタイムで自動的に行われます。 たとえば、自動車を販売する際に 1 つの業務プロセス フローを構成できますが、一般的な見込み評価ステージの後で、ルール (新車と中古車のどちらを希望しているか、予算は $20,000 より上か下かなど) に基づいて 2 つのブランチに分かれます。 一方は新車を販売し、もう一方は中古車を販売します。 業務プロセス フローについて詳しくは、「[Business process flows overview](business-process-flows-overview.md)」 (業務プロセス フローの概要) を参照してください。  
  
 次の図は分岐を含む業務プロセス フローです。  
  
 ![自動車販売プロセスのステップを示すフローチャート](media/example-car-sales-flow-chart.png "自動車販売プロセスのステップを示すフローチャート")  
  
<a name="Points"></a>   
## <a name="what-you-need-to-know-when-designing-business-process-flows-with-branches"></a>分岐を含む業務プロセス フローを設計する際に知る必要があること  
 分岐を含む業務プロセス フローを設計するときは次の情報に注意してください。  
  
-   1 つのプロセスは、最大 5 つの一意のエンティティにまたがることができます。  
  
-   1 プロセスあたり最大 30 ステージ、1 ステージあたり最大 30 ステップを使用できます。  
  
-   各ブランチの深さは 5 段階までです。  
  
-   分岐ルールは、直前にあるステージ内のステップに基づく必要があります。  
  
-   複数の条件を組み合わせて 1 つのルールを作成できます。`AND` 演算子または `OR` 演算子を使用しますが、両方を使用することはできません。  
  
-   プロセス フローを定義するとき、必要に応じてエンティティのリレーションシップを選択できます。 このリレーションシップは 1: N (一対多) のエンティティ リレーションシップである必要があります。  
  
-   複数のアクティブなプロセスを同じデータ レコードに対して同時に実行できます。  
  
-   ドラッグ アンド ドロップを使用して、プロセス フロー上でタイル (ステージ、ステップ、条件など) を配置し直すことができます。  
  
-   ブランチをマージするときは、すべてのピア ブランチを 1 つのステージにマージする必要があります。 ピア ブランチすべてが 1 つのステージにマージされるか、それぞれのブランチがプロセスを終了させる必要があります。 ピア ブランチを他のブランチとマージさせ、同時にそのブランチがプロセスを終了させることはできません。  
  
> [!NOTE]
> - プロセスで使用されるエンティティには、複数回アクセスできます (複数のクローズド エンティティ ループ)。  
> - プロセスはエンティティ型に関係なく前のステージに戻ることができます。 たとえば、アクティブなステージが見積もりレコードに対する **[Deliver Quote]\(見積もりの提供\)** である場合、プロセス ユーザーはアクティブなステージを営業案件レコードに対する **[提案]** ステージに戻すことができます。  
>   
>   もう 1 つの例として、あるプロセスが現在、プロセス フロー ( **[リードを見込みありと評価]**  >  **[Identify Needs]\(ニーズの特定\)**  >  **[Create Proposal]\(提案の作成\)**  >  **[提案の提示]**  >  **[精算]** ) の **[提案の提示]** ステージにあるとします。 顧客に提示した提案で、顧客のニーズを特定するための調査がさらに必要になった場合、ユーザーはプロセスの **[Identify Needs]\(ニーズの特定\)** ステージを選択して、 **[アクティブに設定]** を選ぶだけです。  
  
<a name="CarSelling365"></a>   
## <a name="example-car-selling-process-flow-with-two-branches"></a>例: 2 つの分岐がある自動車販売プロセス フロー
 
2 つのブランチ (新車販売と中古車販売) を含む業務プロセス フローの例を見てみましょう。  
  
 まず、**Car Sales Process** という名前の新しいプロセスを作成します。  
  
1.  [ソリューション エクスプローラーを開き](/powerapps/maker/model-driven-apps/advanced-navigation#solution-explorer)、左側のナビゲーション ウィンドウで **[プロセス]** を選択します。  
  
2.  **[新規]** を選択して、新しいプロセスを作成します。  
  
3.  **[カテゴリ]** で **[業務プロセス フロー]** を選択し、プライマリ **エンティティ**で **[リード]** を選択します。  
  
4.  **[見込みありと評価]** という最初のステージをプロセスに追加し、 **[Purchase Time frame]\(購入時期\)** と **[Car Preference]\(車の選択\)** というステップを追加します。  
  
5.  共通の **[見込みありと評価]** ステージの後で、 **[条件]** タイルを使用してプロセスを 2 つのブランチに分岐させます。  
  
    1.  業務の要件に合うルールを使用して条件タイルを構成します。  
  
    2.  ステージに最初のブランチを追加するには、条件タイルの [はい] のパスにステージ タイルを追加します。  
  
    3.  条件が満たされない場合に実行される 2 番目のブランチを追加するには、もう 1 つのステージ タイルを条件タイルの [いいえ] のパスに追加します。  
  
> [!TIP]
>  既存の条件タイルの [いいえ] のパスにもう 1 つの条件を追加すると、さらに複雑な分岐を作成することができます。  
  
 ![作成された見込みステージを示す画像](media/example-car-sales-qualify-stage.JPG "作成された見込みステージを示す画像")  
  
 **[Car preference]\(車の選択\)**  =  **[New]\(新車\)** の場合、プロセスは **[New Car Sales]\(新車販売\)** ステージに分岐します。そうでない場合は、下にある 2 つ目のブランチの **[Pre-Owned Car Sales]\(中古車販売\)** ステージに移ります。  
  
 ![新車販売ステージを示す画像](media/example-car-sales-new-stage-1.JPG "新車販売ステージを示す画像")  
  
 ![中古車販売のステージ](media/example-car-sales-pre-owned-stage.JPG "中古車販売のステージ")  
  
 **[New Car Sale]\(新車販売\)** ステージまたは **[Pre-Owned Car Sales]\(中古車販売\)** ステージのすべてのステップを完了すると、プロセスはメイン フローの **[Deliver Quote]\(見積もりの提供\)** ステージに戻ります。  
  
 ![納品見積もりのステージ](media/example-car-sales-deliver-quote-stage.JPG "納品見積もりのステージ")  
  
<a name="PreventInformation"></a>   
## <a name="prevent-information-disclosure"></a>情報漏えいを防ぐ  
 銀行でのローン申し込みを処理するための分岐を含む業務プロセス フローについて考えてみます。次の図をご覧ください。 ステージで使用されるカスタム エンティティはかっこで囲んでいます。  
  
 ![情報漏えいを防ぐためのプロセスのステップの例を示すフローチャート](media/example-car-sales-flow-chart-process-prevent-information-disclosure.png "情報漏えいを防ぐためのプロセスのステップの例を示すフローチャート")  
  
 このシナリオでは、銀行のローン担当者は要求レコードにアクセスする必要がありますが、ローン担当者が要求の調査内容を見る必要はありません。 一見したところ、これは、調査エンティティにアクセスできないセキュリティ ロールをローン担当者に割り当てることで簡単に実現しそうです。 ただし、例を詳しく見て、それが本当かどうかを確認しましょう。  
  
 たとえば、顧客が $60,000 を超えるローンを銀行に申し込んだとします。 ローン担当者は最初の段階で申し込みを確認します。 銀行のローンが $50,000 を超えるかどうかを調べる分岐ルールが満たされると、プロセスの次のステージは、申し込みが不正でないかを調査します。 不正であることが判別すると、申し込み者に対して法的な措置を取るようにプロセスが進みます。 ローン担当者は、調査エンティティへのアクセス権がないため、2 つの調査ステージを見ることができません。  
  
 ただし、ローン担当者が申し込みレコードを開くと、エンドツーエンドのプロセス全体を見ることができます。 ローン担当者は、不正な調査ステージを見られるだけでなく、プロセス内の法的措置のステージを見られるため、調査結果を特定することもできます。 また、担当者は、ステージを選択して、調査ステージのステップをプレビューすることもできます。 ローン担当者は、データまたはステップの完了状態を見ることはできませんが、調査と法的措置のステージで申し込み者に対して取られた可能性があるアクションを特定できます。  
  
 このプロセス フローでローン担当者は不正調査と法的措置のステージを見ることができますが、これは不適切な情報漏えいです。 分岐のために漏えいする可能性がある情報には特に注意することをお勧めします。 この例では、プロセスを 2 つのプロセス (1 つは申し込みの処理、もう 1 つは不正調査) に分岐して、情報の漏えいを防ぎます。 ローン担当者にとってプロセスは次のように見えます。  
  
 ![情報漏えいを防ぐためのプロセスの追加ステップを示すフローチャート](media/example-car-sales-flow-chart-additional-steps-prevent-information-disclosure.png "情報漏えいを防ぐためのプロセスの追加ステップを示すフローチャート")  
  
 調査のプロセスは自己完結型になり、次のステージを含みます。  
  
 ![情報漏えいケースの調査プロセスのステップを示すフローチャート](media/example-car-sales-flow-chart-investigation-information-disclosure-case.png "情報漏えいケースの調査プロセスのステップを示すフローチャート")  
  
 承認/拒否の決定を調査レコードから申し込みレコードに同期するためのワークフローを提供する必要があります。  
  
### <a name="next-steps"></a>次のステップ  
 [業務プロセス フローの作成](create-business-process-flow.md)   
 [プロセスを含むカスタム ビジネス ロジックの作成](guide-staff-through-common-tasks-processes.md)   
 
